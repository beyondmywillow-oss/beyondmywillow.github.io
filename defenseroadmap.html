<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bangkok Trip Planner ğŸ¥¥</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Production Version for Stability) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (For JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font -->
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #FDFCF8; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        /* Animation utilities */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root" class="flex items-center justify-center h-screen text-gray-400 text-sm">
        ë¡œë”© ì¤‘ì…ë‹ˆë‹¤... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, Component } = React;

        // --- Error Boundary (ì—ëŸ¬ ë°œìƒ ì‹œ í° í™”ë©´ ëŒ€ì‹  ë©”ì‹œì§€ í‘œì‹œ) ---
        class ErrorBoundary extends Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            render() {
                if (this.state.hasError) {
                    return (
                        <div className="p-6 text-center">
                            <h2 className="text-xl font-bold text-red-500 mb-2">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h2>
                            <p className="text-sm text-gray-500 bg-gray-100 p-4 rounded text-left overflow-auto">
                                {this.state.error.toString()}
                            </p>
                            <button onClick={() => window.location.reload()} className="mt-4 bg-gray-800 text-white px-4 py-2 rounded">
                                ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // --- Icons (SVG Definitions) ---
        const IconBase = ({ children, size = 18, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const MapPin = (props) => <IconBase {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const Utensils = (props) => <IconBase {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></IconBase>;
        const ShoppingBag = (props) => <IconBase {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></IconBase>;
        const Car = (props) => <IconBase {...props}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const ExternalLink = (props) => <IconBase {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></IconBase>;
        const Edit2 = (props) => <IconBase {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></IconBase>;
        const Tag = (props) => <IconBase {...props}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></IconBase>;
        const ChevronDown = (props) => <IconBase {...props}><path d="m6 9 6 6 6-6"/></IconBase>;
        const ChevronUp = (props) => <IconBase {...props}><path d="m18 15-6-6-6 6"/></IconBase>;
        const Calculator = (props) => <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></IconBase>;
        const ArrowRightLeft = (props) => <IconBase {...props}><path d="m16 3 4 4-4 4"/><path d="M20 7H4"/><path d="m8 21-4-4 4-4"/><path d="M4 17h16"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Home = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>;

        // --- Main Component ---
        const BangkokPlanner = () => {
            const [activeTab, setActiveTab] = useState('itinerary'); 
            const [selectedDayId, setSelectedDayId] = useState(1);
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isConverterOpen, setIsConverterOpen] = useState(false);
            const [deleteTarget, setDeleteTarget] = useState(null);

            const [editingEventId, setEditingEventId] = useState(null);
            const [expandedCategory, setExpandedCategory] = useState(null); 
            
            const [exchangeRate, setExchangeRate] = useState(38); 
            const [convertValues, setConvertValues] = useState({ thb: '', krw: '' });

            const [newEntry, setNewEntry] = useState({
                type: 'food', title: '', time: '', cost: '', currency: 'THB', note: '', link: '', items: '',
            });

            // Initial Data
            const initialDays = [
                { id: 1, date: "2/2 (ì›”)", title: "ë°©ì½• ë„ì°© & ì§œëšœì§ ì°¬ìŠ¤", 
                events: [
                    { id: 101, type: 'transport', time: '13:45', title: 'ìˆ˜ì™„ë‚˜í’ˆ ê³µí•­ ë„ì°©', note: '1ì¸µ í¼ë¸”ë¦­ íƒì‹œ/ê·¸ë© ìŠ¹ê°•ì¥ ì´ë™', link: 'https://www.google.com/maps/search/?api=1&query=Suvarnabhumi+Airport' },
                    { id: 102, type: 'transport', title: 'ê³µí•­ â†’ ëŒë¶€ëœ¨ë¦¬', cost: 500, note: 'Grab SUV ì¶”ì²œ (ì§ ê³ ë ¤)' },
                    { id: 103, type: 'etc', time: '15:30', title: 'ëŒë¶€ëœ¨ë¦¬ ë¹Œë¦¬ì§€', note: 'ì²´í¬ì¸ & ì§ í’€ê¸°', link: 'https://www.google.com/maps/search/?api=1&query=Rambuttri+Village+Inn' },
                    { id: 104, type: 'visit', time: '16:30', title: 'ì§œëšœì§ ì£¼ë§ ì‹œì¥', note: 'GLN ê²°ì œ í•„ìˆ˜, ì£¼ë§ í•œì •', link: 'https://www.google.com/maps/search/?api=1&query=Chatuchak+Weekend+Market' },
                    { id: 105, type: 'food', time: '19:00', title: 'ì‹œì¥ ë‚´ ë¡œì»¬ í‘¸ë“œ', note: 'ë¹ ì—ì•¼ ì•„ì €ì”¨ë„¤', cost: 300, menu: 'í•´ì‚°ë¬¼ ë¹ ì—ì•¼, ë•¡ëª¨ë°˜' },
                    { id: 106, type: 'visit', time: '21:00', title: 'ëŒë¶€ëœ¨ë¦¬ ë¡œë“œ', note: 'ë°œë§ˆì‚¬ì§€ & íœ´ì‹', link: 'https://www.google.com/maps/search/?api=1&query=Soi+Ram+Buttri' }
                ]
                },
                { id: 2, date: "2/3 (í™”)", title: "ì˜¬ë“œì‹œí‹° & ì™“ ì•„ë£¬", 
                events: [
                    { id: 201, type: 'food', time: '11:00', title: 'ì¿¤ëŒ• ê¾¸ì–´ì´ì§­ ìœ ì•ˆ', note: 'ëˆì  êµ­ìˆ˜', cost: 150, menu: 'ëˆì êµ­ìˆ˜, ìŠ¤í”„ë§ë¡¤', link: 'https://www.google.com/maps/search/?api=1&query=Khun+Deng+Guay+Jub+Yuan' },
                    { id: 202, type: 'visit', time: '13:00', title: 'ì™“ ì•„ë£¬ (ìƒˆë²½ ì‚¬ì›)', note: 'ìˆ˜ìƒë²„ìŠ¤ ì´ë™', link: 'https://www.google.com/maps/search/?api=1&query=Wat+Arun' },
                    { id: 203, type: 'food', time: '15:00', title: 'ì¹´í˜ ë·° ì•„ë£¬', note: 'ì‚¬ì› ë·° ì—ì–´ì»¨ ì¹´í˜', cost: 200 },
                    { id: 204, type: 'food', time: '18:00', title: 'íŒì‹¸ë§ˆì´', note: 'ì˜¤ë Œì§€ ì£¼ìŠ¤ í•„ìˆ˜', cost: 400, link: 'https://www.google.com/maps/search/?api=1&query=Thipsamai' },
                    { id: 205, type: 'visit', time: '20:00', title: 'ì¹´ì˜¤ì‚° ë¡œë“œ', note: 'I love Khaosan ë§¥ë‚  ì•', link: 'https://www.google.com/maps/search/?api=1&query=Khaosan+Road' }
                ]
                },
                { id: 3, date: "2/4 (ìˆ˜)", title: "ë¹ˆí‹°ì§€ ì°¨ê³  & ë¡œì»¬", 
                events: [
                    { id: 301, type: 'transport', title: 'ìˆ™ì†Œ â†’ ëí”„ë¼ì˜¤', cost: 300, note: 'ê·¸ë© í•„ìˆ˜ (ê±°ë¦¬ ë©‚)' },
                    { id: 302, type: 'visit', time: '13:00', title: 'The Garage', note: 'ë¹ˆí‹°ì§€ìƒµ êµ¬ê²½', link: 'https://maps.app.goo.gl/p4jMDyHCmcJBQrxy6' },
                    { id: 303, type: 'food', time: '15:00', title: 'ëí”„ë¼ì˜¤ ë¡œì»¬ ë§›ì§‘', note: 'ê·¼ì²˜ êµ­ìˆ˜ì§‘', cost: 150 },
                    { id: 304, type: 'visit', time: '17:00', title: 'ì„¼íŠ¸ëŸ´ ëí”„ë¼ì˜¤', note: 'ì‡¼í•‘ëª° êµ¬ê²½', link: 'https://www.google.com/maps/search/?api=1&query=Central+Plaza+Ladprao' },
                    { id: 305, type: 'transport', title: 'ìˆ™ì†Œ ë³µê·€', cost: 300 }
                ]
                },
                { id: 4, date: "2/5 (ëª©)", title: "ìº í¼ìŠ¤ íˆ¬ì–´ & ê³µì›", 
                events: [
                    { id: 401, type: 'visit', time: '11:00', title: 'ì­ë¼ë¡±ê¹ ëŒ€í•™êµ', note: 'ìº í¼ìŠ¤ ì‚°ì±…', link: 'https://www.google.com/maps/search/?api=1&query=Chulalongkorn+University' },
                    { id: 402, type: 'food', time: '12:30', title: 'ì‚¼ì–€ ë°‹íƒ€ìš´ í‘¸ë“œì½”íŠ¸', note: 'ê°€ì„±ë¹„ ì ì‹¬', cost: 200, link: 'https://www.google.com/maps/search/?api=1&query=Samyan+Mitrtown' },
                    { id: 403, type: 'visit', time: '16:00', title: 'ë²¤ìí‚¤í‹° ê³µì›', note: 'í•´ ì§ˆ ë…˜ ë…¸ì„', link: 'https://www.google.com/maps/search/?api=1&query=Benchakitti+Park' },
                    { id: 404, type: 'food', time: '19:00', title: 'ì©¨ì˜¤ ì­ë¼', note: 'ë§ˆë§ˆ ë˜ ì–Œ ë¼ë©´', cost: 500, link: 'https://www.google.com/maps/search/?api=1&query=Jeh+O+Chula' }
                ]
                },
                { id: 5, date: "2/6 (ê¸ˆ)", title: "í˜¸í…” ì´ë™ & ì‹œì•”", 
                events: [
                    { id: 501, type: 'etc', time: '11:00', title: 'ê·¸ëœë“œ ì„¼í„° í¬ì¸íŠ¸', note: 'ëì°¨ë‹´ë¦¬ ì²´í¬ì¸', link: 'https://www.google.com/maps/search/?api=1&query=Grande+Centre+Point+Ratchadamri' },
                    { id: 502, type: 'food', time: '13:00', title: 'ì†œë¶„ ì”¨í‘¸ë“œ', note: 'í‘¸íŒŸíì»¤ë¦¬', cost: 1200 },
                    { id: 503, type: 'shop', time: '15:00', title: 'ì‹œì•” íŒŒë¼ê³¤', note: 'ëª…í’ˆê´€/ì„¸í¬ë¼', cost: 0, items: [], link: 'https://www.google.com/maps/search/?api=1&query=Siam+Paragon' },
                    { id: 504, type: 'shop', time: '17:00', title: 'ì´ë¸Œì•¤ë³´ì´', note: 'íƒœêµ­ í™”ì¥í’ˆ', cost: 2000, items: ['í°ì¦ˆ íŒŒìš°ë”', 'SRICHAND', '4U2 ë¸”ëŸ¬ì…”'] },
                    { id: 505, type: 'etc', time: '20:00', title: 'í˜¸í…” ìˆ˜ì˜ì¥', note: 'íœ´ì‹' }
                ]
                },
                { id: 6, date: "2/7 (í† )", title: "ë¹…ì”¨ ì‡¼í•‘ ë°ì´", 
                events: [
                    { id: 601, type: 'food', time: '11:30', title: 'ì„¼íŠ¸ëŸ´ ì›”ë“œ', note: 'ì ì‹¬ ì‹ì‚¬', cost: 800 },
                    { id: 602, type: 'shop', time: '14:00', title: 'ë¹…ì”¨ ë§ˆì¼“ ëì°¨ë‹´ë¦¬', note: 'ê¸°ë…í’ˆ ì‡¼í•‘', cost: 3000, items: ['ì¿¤ë‚˜ ë§ê³ ', 'ì™•ì‹¤ ê¿€', 'ì„ ì‹¤í¬', 'ì°¨íŠ¸ë¼ë®¤'], link: 'https://www.google.com/maps/search/?api=1&query=Big+C+Supercenter+Ratchadamri' },
                    { id: 603, type: 'transport', title: 'ì§ ë‘ëŸ¬ í˜¸í…”', note: 'ë„ë³´/íˆ­íˆ­' },
                    { id: 604, type: 'food', time: '18:00', title: 'ê³ ì•™ ë¹ ëšœë‚¨', note: 'í•‘í¬ ì¹´ì˜¤ë§Œê°€ì´', cost: 100, link: 'https://www.google.com/maps/search/?api=1&query=Go-Ang+Pratunam+Chicken+Rice' },
                    { id: 605, type: 'visit', time: '20:00', title: 'í‹°ì¸„ì¹´ ë£¨í”„íƒ‘', note: 'ì•¼ê²½', cost: 1000, link: 'https://www.google.com/maps/search/?api=1&query=Tichuca+Rooftop+Bar' }
                ]
                },
                { id: 7, date: "2/8 (ì¼)", title: "ë£¸í”¼ë‹ˆ & ë¦´ë ‰ìŠ¤", 
                events: [
                    { id: 701, type: 'visit', time: '10:00', title: 'ë£¸í”¼ë‹ˆ ê³µì›', note: 'ì˜¤ë¦¬ë°°', link: 'https://www.google.com/maps/search/?api=1&query=Lumphini+Park' },
                    { id: 702, type: 'food', time: '12:30', title: 'ë…¸ìŠ¤ì´ìŠ¤íŠ¸', note: 'í•œêµ­ì¸ ë§›ì§‘', cost: 900, link: 'https://www.google.com/maps/search/?api=1&query=Northeast+Restaurant+Bangkok' },
                    { id: 703, type: 'etc', time: '15:00', title: 'ë””ë°”ë‚˜ ìŠ¤íŒŒ', note: 'ë§ˆì‚¬ì§€', cost: 1500 },
                    { id: 704, type: 'shop', time: '18:00', title: 'ì•„ì´ì½˜ ì‹œì•”', note: 'ë¶„ìˆ˜ì‡¼ & ì•¼ê²½', cost: 0, link: 'https://www.google.com/maps/search/?api=1&query=ICONSIAM' }
                ]
                },
                { id: 8, date: "2/9 (ì›”)", title: "êµ¿ë°”ì´ ë°©ì½•", 
                events: [
                    { id: 801, type: 'etc', time: '12:00', title: 'ì²´í¬ì•„ì›ƒ', note: 'ì§ ë³´ê´€' },
                    { id: 802, type: 'food', time: '13:00', title: 'ë§ˆì§€ë§‰ ë¡œì»¬ ì‹ì‚¬', note: 'ë§›ì§‘ íƒë°©' },
                    { id: 803, type: 'food', time: '15:00', title: 'ë‘ìˆ˜ì–¸ ë¡œë“œ ì¹´í˜', note: 'ìŠ¤íƒ€ë²…ìŠ¤ ë“±' },
                    { id: 804, type: 'transport', time: '21:00', title: 'ê³µí•­ ì´ë™', note: '21:30 ë„ì°© ëª©í‘œ' },
                    { id: 805, type: 'transport', time: '00:55', title: 'ì¸ì²œí–‰ ì¶œë°œ', note: '2/10(ì›”) ì•„ì¹¨ ë„ì°©' }
                ]
                }
            ];

            const [days, setDays] = useState(() => {
                try {
                    const saved = localStorage.getItem('bangkokTripDataFinalV6');
                    return saved ? JSON.parse(saved) : initialDays;
                } catch (e) {
                    console.error("Storage Error", e);
                    return initialDays;
                }
            });

            useEffect(() => {
                localStorage.setItem('bangkokTripDataFinalV6', JSON.stringify(days));
            }, [days]);

            const handleThbChange = (e) => {
                const val = e.target.value;
                setConvertValues({ thb: val, krw: val ? Math.round(Number(val) * exchangeRate) : '' });
            };
            const handleKrwChange = (e) => {
                const val = e.target.value;
                setConvertValues({ thb: val ? (Number(val) / exchangeRate).toFixed(2) : '', krw: val });
            };

            const openAddModal = () => {
                setNewEntry({ type: 'food', title: '', time: '', cost: '', currency: 'THB', note: '', link: '', items: '' });
                setEditingEventId(null);
                setIsModalOpen(true);
            };

            const openEditModal = (event) => {
                let mappedType = event.type;
                // ì•ˆì „ì¥ì¹˜: ì´ìƒí•œ íƒ€ì…ì´ ë“¤ì–´ì™€ë„ ê¸°ë³¸ê°’ ì²˜ë¦¬
                if (!['food', 'visit', 'shop', 'transport', 'etc'].includes(mappedType)) {
                    if (['flight', 'taxi'].includes(mappedType)) mappedType = 'transport';
                    else if (['coffee', 'dessert'].includes(mappedType)) mappedType = 'food';
                    else if (['checkin', 'massage'].includes(mappedType)) mappedType = 'etc';
                    else mappedType = 'visit';
                }
                setNewEntry({
                    type: mappedType,
                    title: event.title || '',
                    time: event.time || '',
                    cost: event.cost || '',
                    currency: 'THB',
                    note: event.note || '',
                    link: event.link || '',
                    items: event.type === 'shop' && event.items ? event.items.join(', ') : (event.menu || ''),
                });
                setEditingEventId(event.id);
                setIsModalOpen(true);
            };

            const handleSaveEntry = () => {
                if (!newEntry.title) return;
                const processedItems = (newEntry.type === 'shop' || newEntry.type === 'food') && newEntry.items ? newEntry.items.split(',').map(i => i.trim()) : [];
                const eventData = {
                    type: newEntry.type,
                    title: newEntry.title,
                    time: newEntry.time,
                    cost: newEntry.cost ? Number(newEntry.cost) : 0,
                    note: newEntry.note,
                    link: newEntry.link,
                    items: newEntry.type === 'shop' ? processedItems : [],
                    menu: newEntry.type === 'food' ? newEntry.items : undefined
                };

                if (editingEventId) {
                    setDays(prev => prev.map(d => d.id === selectedDayId ? { ...d, events: d.events.map(ev => ev.id === editingEventId ? { ...ev, ...eventData } : ev).sort((a, b) => (a.time || '').localeCompare(b.time || '')) } : d));
                } else {
                    setDays(prev => prev.map(d => d.id === selectedDayId ? { ...d, events: [...d.events, { id: Date.now(), ...eventData }].sort((a, b) => (a.time || '').localeCompare(b.time || '')) } : d));
                }
                setIsModalOpen(false);
            };

            const initiateDelete = (dayId, eventId, e) => {
                e.stopPropagation();
                setDeleteTarget({ dayId, eventId });
            };
            const confirmDelete = () => {
                if (!deleteTarget) return;
                setDays(prev => prev.map(d => d.id === deleteTarget.dayId ? { ...d, events: d.events.filter(ev => ev.id !== deleteTarget.eventId) } : d));
                setDeleteTarget(null);
            };
            const cancelDelete = () => setDeleteTarget(null);
            const toggleCategory = (cat) => setExpandedCategory(expandedCategory === cat ? null : cat);

            const colors = {
                bg: "bg-[#FDFCF8]",
                card: "bg-white",
                blue: { bg: "bg-sky-100", text: "text-sky-600", border: "border-sky-200" }, 
                green: { bg: "bg-lime-100", text: "text-lime-700", border: "border-lime-200" }, 
                purple: { bg: "bg-purple-100", text: "text-purple-600", border: "border-purple-200" }, 
                orange: { bg: "bg-orange-50", text: "text-orange-600", border: "border-orange-100" }, 
                pink: { bg: "bg-rose-50", text: "text-rose-500", border: "border-rose-100" }, 
            };

            const getCategoryColor = (type) => {
                switch (type) {
                    case 'shop': return colors.purple;
                    case 'transport': return colors.blue;
                    case 'food': return colors.orange;
                    case 'etc': return colors.pink;
                    default: return colors.green;
                }
            };

            const getIcon = (type) => {
                const className = `w-5 h-5 ${getCategoryColor(type).text}`;
                switch (type) {
                    case 'food': return <Utensils className={className} />;
                    case 'shop': return <ShoppingBag className={className} />;
                    case 'transport': return <Car className={className} />;
                    case 'etc': return <Home className={className} />;
                    default: return <MapPin className={className} />;
                }
            };

            const currentDay = days.find(d => d.id === selectedDayId);
            const stats = useMemo(() => days.reduce((acc, d) => acc + d.events.reduce((s, e) => s + (e.cost || 0), 0), 0), [days]);
            const expensesByCategory = useMemo(() => {
                const cats = {
                    shop: { label: 'ì‡¼í•‘ (Shopping)', total: 0, items: [], color: colors.purple },
                    food: { label: 'ì‹ë¹„ (Food)', total: 0, items: [], color: colors.orange },
                    transport: { label: 'êµí†µ (Transport)', total: 0, items: [], color: colors.blue },
                    others: { label: 'ìˆ™ì†Œ/ê¸°íƒ€ (Others)', total: 0, items: [], color: colors.pink }
                };
                days.forEach(day => day.events.forEach(event => {
                    if (event.cost > 0) {
                        let target = cats.others;
                        if (event.type === 'shop') target = cats.shop;
                        else if (event.type === 'food') target = cats.food;
                        else if (event.type === 'transport') target = cats.transport;
                        else if (['etc', 'checkin', 'visit'].includes(event.type)) target = cats.others;
                        if (event.type === 'visit') target = cats.others; 
                        target.total += event.cost;
                        target.items.push({ ...event, date: day.date });
                    }
                }));
                return cats;
            }, [days]);

            return (
                <div className={`max-w-md mx-auto h-screen ${colors.bg} flex flex-col font-sans text-slate-700 animate-fade-in`}>
                    {/* Header */}
                    <header className="px-4 pt-6 pb-2 bg-white/90 backdrop-blur-md sticky top-0 z-30 border-b border-stone-100 shadow-sm">
                        <div className="flex justify-between items-center mb-3">
                            <h1 className="text-xl font-bold text-stone-800 tracking-tight">Bangkok Trip ğŸ¥¥</h1>
                            <div className="flex items-center gap-3">
                                <button onClick={() => setIsConverterOpen(true)} className="p-2 bg-stone-100 rounded-full text-stone-600 hover:bg-stone-200 transition-colors" title="í™˜ìœ¨ ê³„ì‚°ê¸°"><Calculator size={18} /></button>
                                <div className="text-right">
                                    <span className="text-[10px] font-bold text-stone-400 block uppercase tracking-wider">Total</span>
                                    <span className="text-lg font-bold text-stone-700 leading-none">{stats.toLocaleString()} B</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex p-1 bg-stone-100 rounded-xl">
                            <button onClick={() => setActiveTab('itinerary')} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${activeTab === 'itinerary' ? 'bg-white text-stone-800 shadow-sm' : 'text-stone-400'}`}>ì—¬í–‰ ì¼ì •</button>
                            <button onClick={() => setActiveTab('shopping')} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${activeTab === 'shopping' ? 'bg-white text-purple-600 shadow-sm' : 'text-stone-400'}`}>ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</button>
                        </div>
                    </header>

                    {/* Content */}
                    <div className="flex-1 overflow-hidden relative">
                        {activeTab === 'itinerary' && (
                            <div className="h-full flex flex-col">
                                <div className="overflow-x-auto whitespace-nowrap px-4 py-3 shrink-0 scrollbar-hide bg-white/50">
                                    <div className="flex space-x-2">
                                        {days.map(day => (
                                            <button key={day.id} onClick={() => setSelectedDayId(day.id)} className={`flex flex-col items-center justify-center min-w-[56px] h-[56px] rounded-xl transition-all border ${selectedDayId === day.id ? 'bg-lime-100 border-lime-300 text-lime-800 shadow-sm scale-105' : 'bg-white border-stone-100 text-stone-400'}`}>
                                                <span className="text-[10px] font-bold uppercase">{day.date.split(' ')[1].replace(/[()]/g, '')}</span>
                                                <span className="text-sm font-bold">{day.date.split(' ')[0].split('/')[1]}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto px-4 pb-24">
                                    <div className="bg-stone-800 text-white p-4 rounded-2xl mb-5 flex justify-between items-center shadow-lg shadow-stone-200 mt-2">
                                        <div><span className="text-lime-400 font-bold text-[10px] tracking-wider uppercase mb-1 block">Travel Log</span><h2 className="text-lg font-bold">{currentDay.date}</h2></div>
                                        <div className="flex items-center gap-3">
                                            <div className="text-right"><span className="block text-[10px] text-stone-400 font-medium tracking-wider">DAY</span><span className="block text-2xl font-black leading-none">{currentDay.id}</span></div>
                                            <div className="h-8 w-[1px] bg-stone-600"></div>
                                            <div className="bg-white/10 backdrop-blur-md px-3 py-1.5 rounded-lg border border-white/10"><span className="font-bold text-sm">D+{currentDay.id}</span></div>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        {currentDay.events.map((event, index) => {
                                            const style = getCategoryColor(event.type);
                                            return (
                                                <div key={event.id} className="relative pl-3">
                                                    {index !== currentDay.events.length - 1 && <div className="absolute left-[22px] top-10 bottom-[-24px] w-[2px] bg-stone-100"></div>}
                                                    <div className="flex gap-3">
                                                        <div className={`shrink-0 w-10 h-10 rounded-full ${style.bg} flex items-center justify-center border-2 border-white shadow-sm z-10`}>{getIcon(event.type)}</div>
                                                        <div className={`flex-1 bg-white p-4 rounded-2xl border ${style.border} shadow-sm relative group`}>
                                                            <div className="absolute top-3 right-3 flex gap-2 z-20">
                                                                <button onClick={(e) => { e.stopPropagation(); openEditModal(event); }} className="p-1.5 bg-stone-50 rounded-full text-stone-400 hover:text-sky-500 hover:bg-sky-50 transition-colors cursor-pointer"><Edit2 size={12}/></button>
                                                                <button onClick={(e) => initiateDelete(currentDay.id, event.id, e)} className="p-1.5 bg-stone-50 rounded-full text-stone-400 hover:text-red-500 hover:bg-red-50 transition-colors cursor-pointer"><Trash2 size={12}/></button>
                                                            </div>
                                                            <div className="flex items-center gap-2 mb-1 pr-14">
                                                                <span className={`text-[10px] font-bold px-2 py-0.5 rounded-md ${style.bg} ${style.text}`}>{event.time || 'Time'}</span>
                                                                {event.link && <a href={event.link} target="_blank" rel="noreferrer" className="text-stone-300 hover:text-sky-500"><ExternalLink size={12} /></a>}
                                                            </div>
                                                            <h3 className="font-bold text-stone-700 pr-2 text-sm">{event.title}</h3>
                                                            {event.note && <p className="text-xs text-stone-400 mt-1">{event.note}</p>}
                                                            {(event.cost > 0 || event.menu || (event.items && event.items.length > 0)) && (
                                                                <div className="mt-3 pt-3 border-t border-stone-50 flex flex-wrap gap-2">
                                                                    {event.cost > 0 && <div className="text-xs font-bold text-stone-600 bg-stone-100 px-2 py-1 rounded">-{event.cost.toLocaleString()} B</div>}
                                                                    {event.menu && <div className="text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded border border-orange-100">{event.menu}</div>}
                                                                    {event.items && event.items.map((item, i) => <div key={i} className="text-xs text-purple-600 bg-purple-50 px-2 py-1 rounded border border-purple-100">{item}</div>)}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <button onClick={openAddModal} className="mt-6 w-full py-3.5 rounded-xl border-2 border-dashed border-stone-300 text-stone-400 font-bold text-sm hover:border-lime-400 hover:text-lime-600 hover:bg-lime-50 transition-all flex items-center justify-center gap-2"><Plus size={16} /> ì¼ì • ì¶”ê°€í•˜ê¸°</button>
                                </div>
                            </div>
                        )}
                        {activeTab === 'shopping' && (
                            <div className="h-full overflow-y-auto px-4 py-4 pb-24">
                                <div className="bg-gradient-to-br from-violet-100 to-white p-5 rounded-3xl shadow-sm border border-violet-100 mb-5">
                                    <div className="flex items-center gap-3 mb-2"><div className="p-2 bg-white rounded-full text-purple-500 shadow-sm"><Tag size={18}/></div><h3 className="text-sm font-bold text-purple-900">ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ìš”ì•½</h3></div>
                                    <div className="flex items-baseline gap-1 mt-1"><span className="text-3xl font-bold text-purple-600">{stats.toLocaleString()}</span><span className="text-sm font-bold text-purple-400">THB</span></div>
                                    <p className="text-xs text-stone-400 mt-1">í•œí™” ì•½ {(stats * exchangeRate).toLocaleString()}ì› (í™˜ìœ¨ {exchangeRate}ì› ê¸°ì¤€)</p>
                                </div>
                                <div className="space-y-3">
                                    {['shop', 'food', 'transport', 'others'].map(catKey => {
                                        const category = expensesByCategory[catKey];
                                        if (category.total === 0) return null;
                                        return (
                                            <div key={catKey} className="bg-white rounded-2xl shadow-sm border border-stone-100 overflow-hidden">
                                                <button onClick={() => toggleCategory(catKey)} className="w-full flex justify-between items-center p-4 bg-white hover:bg-stone-50 transition-colors">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${category.color.bg} ${category.color.text}`}>
                                                            {catKey === 'shop' && <ShoppingBag size={18} />}{catKey === 'food' && <Utensils size={18} />}{catKey === 'transport' && <Car size={18} />}{catKey === 'others' && <Home size={18} />}
                                                        </div>
                                                        <div className="text-left"><h4 className="font-bold text-stone-700 text-sm">{category.label}</h4><p className="text-xs text-stone-400">{category.items.length}ê±´</p></div>
                                                    </div>
                                                    <div className="flex items-center gap-2"><span className="font-bold text-stone-700 text-sm">{category.total.toLocaleString()} B</span>{expandedCategory === catKey ? <ChevronUp size={16} className="text-stone-300"/> : <ChevronDown size={16} className="text-stone-300"/>}</div>
                                                </button>
                                                {expandedCategory === catKey && (
                                                    <div className="bg-stone-50 p-4 border-t border-stone-100 space-y-3">
                                                        {category.items.map((item, idx) => (
                                                            <div key={idx} className="flex justify-between items-start text-sm">
                                                                <div className="flex-1 pr-4">
                                                                    <div className="flex items-center gap-2"><span className="text-[10px] font-bold text-stone-400 bg-white px-1.5 rounded border border-stone-200">{item.date.split(' ')[0]}</span><span className="font-medium text-stone-700">{item.title}</span></div>
                                                                    {(item.items?.length > 0 || item.menu) && <p className="text-xs text-stone-400 mt-1 pl-1 border-l-2 border-stone-200">{item.menu || item.items.join(', ')}</p>}
                                                                </div>
                                                                <span className="font-bold text-stone-600 shrink-0">{item.cost.toLocaleString()}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Modals */}
                    {isModalOpen && (
                        <div className="absolute inset-0 z-50 flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-[2px]">
                            <div className="bg-white w-full max-w-md p-6 rounded-t-3xl sm:rounded-3xl shadow-xl animate-in slide-in-from-bottom-10 duration-300">
                                <div className="flex justify-between items-center mb-6"><h3 className="font-bold text-lg text-stone-800">{editingEventId ? 'ì¼ì • ìˆ˜ì •' : 'ìƒˆë¡œìš´ ì¼ì •'}</h3><button onClick={() => setIsModalOpen(false)} className="p-2 bg-stone-100 rounded-full text-stone-500"><X size={18}/></button></div>
                                <div className="space-y-4">
                                    <div className="grid grid-cols-5 gap-2">{['food','visit','shop','transport','etc'].map(type => (
                                        <button key={type} onClick={() => setNewEntry({...newEntry, type})} className={`py-2.5 rounded-xl text-xs font-bold transition-all border ${newEntry.type === type ? 'bg-stone-800 text-white border-stone-800 shadow-md' : 'bg-white text-stone-400 border-stone-100 hover:bg-stone-50'}`}>{type === 'food' ? 'ì‹ì‚¬/ì¹´í˜' : type === 'visit' ? 'ê´€ê´‘' : type === 'shop' ? 'ì‡¼í•‘' : type === 'transport' ? 'ì´ë™' : 'ìˆ™ì†Œ/ê¸°íƒ€'}</button>
                                    ))}</div>
                                    <div className="space-y-1"><label className="text-[10px] font-bold text-stone-400 uppercase">Title</label><input className="w-full bg-stone-50 p-3 rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-lime-200" placeholder="ì¥ì†Œëª… ì…ë ¥" value={newEntry.title} onChange={e => setNewEntry({...newEntry, title: e.target.value})}/></div>
                                    <div className="flex gap-3">
                                        <div className="flex-1 space-y-1"><label className="text-[10px] font-bold text-stone-400 uppercase">Time</label><input type="time" className="w-full bg-stone-50 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-lime-200" value={newEntry.time} onChange={e => setNewEntry({...newEntry, time: e.target.value})}/></div>
                                        <div className="flex-1 space-y-1"><label className="text-[10px] font-bold text-stone-400 uppercase">Cost (THB)</label><input type="number" className="w-full bg-stone-50 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-lime-200" placeholder="0" value={newEntry.cost} onChange={e => setNewEntry({...newEntry, cost: e.target.value})}/></div>
                                    </div>
                                    {(newEntry.type === 'shop' || newEntry.type === 'food') && <div className="space-y-1"><label className="text-[10px] font-bold text-stone-400 uppercase">{newEntry.type === 'shop' ? 'Items' : 'Menu'}</label><input className="w-full bg-stone-50 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-lime-200" placeholder="ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„" value={newEntry.items} onChange={e => setNewEntry({...newEntry, items: e.target.value})}/></div>}
                                    <div className="space-y-1"><label className="text-[10px] font-bold text-stone-400 uppercase">Google Map Link</label><input className="w-full bg-stone-50 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-lime-200" placeholder="ì„ íƒì‚¬í•­" value={newEntry.link} onChange={e => setNewEntry({...newEntry, link: e.target.value})}/></div>
                                    <div className="space-y-1"><label className="text-[10px] font-bold text-stone-400 uppercase">Memo</label><textarea className="w-full bg-stone-50 p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-lime-200 resize-none h-20" placeholder="ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”" value={newEntry.note} onChange={e => setNewEntry({...newEntry, note: e.target.value})}/></div>
                                    <button onClick={handleSaveEntry} className="w-full bg-lime-400 text-lime-900 py-4 rounded-xl font-bold shadow-lg shadow-lime-200 hover:bg-lime-500 hover:text-white transition-all">ì €ì¥í•˜ê¸°</button>
                                </div>
                            </div>
                        </div>
                    )}
                    {isConverterOpen && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-[2px]">
                            <div className="bg-white w-full max-w-xs p-6 rounded-3xl shadow-xl transform transition-all scale-100">
                                <div className="flex justify-between items-center mb-6"><h3 className="font-bold text-lg text-stone-800 flex items-center gap-2"><Calculator size={18} className="text-purple-500"/> í™˜ìœ¨ ê³„ì‚°ê¸°</h3><button onClick={() => setIsConverterOpen(false)} className="p-2 bg-stone-100 rounded-full text-stone-500"><X size={16}/></button></div>
                                <div className="bg-stone-50 p-4 rounded-2xl mb-4"><div className="flex justify-between text-xs font-bold text-stone-400 mb-2 uppercase tracking-wider"><span>Rate Setting</span><span>1 THB = {exchangeRate} KRW</span></div><input type="range" min="35" max="45" step="0.5" value={exchangeRate} onChange={(e) => setExchangeRate(Number(e.target.value))} className="w-full accent-purple-500"/></div>
                                <div className="space-y-4">
                                    <div className="relative"><label className="text-[10px] font-bold text-stone-400 absolute top-2 left-3">THB (ë°”íŠ¸)</label><input type="number" className="w-full bg-white border border-stone-200 p-3 pt-6 rounded-xl text-lg font-bold outline-none focus:border-purple-300 focus:ring-2 focus:ring-purple-100" placeholder="0" value={convertValues.thb} onChange={handleThbChange}/></div>
                                    <div className="flex justify-center -my-2 relative z-10"><div className="bg-stone-100 p-2 rounded-full border border-white shadow-sm"><ArrowRightLeft size={16} className="text-stone-400"/></div></div>
                                    <div className="relative"><label className="text-[10px] font-bold text-stone-400 absolute top-2 left-3">KRW (ì›)</label><input type="number" className="w-full bg-white border border-stone-200 p-3 pt-6 rounded-xl text-lg font-bold outline-none focus:border-purple-300 focus:ring-2 focus:ring-purple-100" placeholder="0" value={convertValues.krw} onChange={handleKrwChange}/></div>
                                </div>
                                <button onClick={() => setConvertValues({thb: '', krw: ''})} className="w-full mt-6 py-3 rounded-xl bg-stone-100 text-stone-500 font-bold text-sm hover:bg-stone-200">ì´ˆê¸°í™”</button>
                            </div>
                        </div>
                    )}
                    {deleteTarget && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-6">
                            <div className="bg-white w-full max-w-sm p-6 rounded-2xl shadow-xl animate-in zoom-in-95 duration-200">
                                <h3 className="text-lg font-bold text-stone-800 mb-2">ì¼ì • ì‚­ì œ</h3><p className="text-stone-500 text-sm mb-6">ì •ë§ë¡œ ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br/><span className="text-xs text-stone-400">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span></p>
                                <div className="flex gap-3"><button onClick={cancelDelete} className="flex-1 py-3 rounded-xl bg-stone-100 text-stone-600 font-bold text-sm hover:bg-stone-200 transition-colors">ì·¨ì†Œ</button><button onClick={confirmDelete} className="flex-1 py-3 rounded-xl bg-red-500 text-white font-bold text-sm hover:bg-red-600 shadow-lg shadow-red-200 transition-colors">ì‚­ì œ</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ErrorBoundary>
                <BangkokPlanner />
            </ErrorBoundary>
        );
    </script>
</body>
</html>

